# Changelog

## 0.1.4 - 25-08-09

### Added

- **Custom font support for `resvg`**:
  - Fonts used in SVG templates can now be bundled in `outdir/assets/fonts` in `.ttf` or `.otf` format.
  - Font filenames are irrelevant — the internal font family name must match exactly what’s used in your SVG/CSS.
  - This ensures consistent rendering regardless of what’s installed on the system.

### Fixed

- **Multi-line text positioning**:  
  Removed the old vertical-centering offset logic that caused multiple lines to appear shifted upward.  
  Lines now stack naturally from the first line downwards.

## 0.1.3 - 25-08-08

### Fixed

- `formatTitleLines()` now correctly applies default values when `ogImageOptions` is missing, preventing a subtle `undefined` error that previously occurred when used with default templates.
- Fixed a bug in `ensureDir()` where a PNG file path was mistakenly passed instead of a directory path, causing permission errors on Windows due to invalid directory creation attempts.

### Changed

- `ensureDir()` is now guarded and only called once per build to reduce redundant filesystem operations.
- Manifest is now loaded once and cached in memory across all image generations to prevent unnecessary reads.
- Manifest writes are now **debounced**: changes are persisted to disk only once after a 500ms idle period. This prevents excessive writes during batch builds and avoids blocking the main process.
- Introduced `flushManifestImmediately()` for controlled environments where a forced sync to disk is required (e.g. before exiting or after batch generation).

### Internal

- Manifest cache and write state are tracked via module-scoped variables (`manifestCache`, `manifestLoaded`, `debounceTimer`, etc.), scoped to the build process lifecycle.
- Debounce is implemented via `setTimeout` and clears/reset per mutation to guarantee eventual consistency with minimal I/O.
- This refactor supports long-running processes (e.g. SSGs, dev watchers) where image generation is triggered repeatedly without process termination.

---

## 0.1.2 - 25-08-06 Patch

### Fixed

- Prevented crash when ogImageOptions is undefined by ensuring default values are applied correctly during formatTitleLines call.

---

## 0.1.1 - 25-08-06 Cleanup

- Removed incorrect `dependencies` from `package.json`

---

## 0.1.0 - 25-08-06 Initial Release

- Added `generateOgImage` function
- Supports:
  - Dynamic `title` injection into SVG templates
  - Line-wrapping for long titles using `<tspan>`
  - Optional control via `ogImageOptions` (e.g. `x`, `maxLength`, `lineHeight`)
  - Conversion to PNG using `resvg` v0.45.1
  - Uses temp directory for intermediate SVGs
  - Cross-platform binary support (Windows, macOS, Linux)
  - Cache manifest file to skip redundant image generation
